{"version":3,"names":[],"mappings":"","sources":["js/common/flower.js"],"sourcesContent":["define([\"jquery\",\"clib/modal\",\"common/validate\",\"common/utils\",\"common/pay\",\"common/tip\"],function(t,i,o,n,s,a){function e(t){alert(t.data.msg)}function r(t){var i=this;203==t.status?i.openPayTipDialog():alert(t.data.msg)}var l=function(i){this.dialogEvents={},this.options=t.extend(!0,{},l.defaults,i),this.options.dialog&&(this.setDialog(this.options.dialog),p.init(this.$dialog)),\"object\"==typeof this.options.target&&(this.target=this.options.target),this.info={}};l.defaults={urls:{info:\"http://api.star.kankan.com/hit_info?jsoncallback=?\",present:\"http://backend.star.kankan.com/hit?jsoncallback=?\",dialog:\"/present_flower_dialog.html\"}},l.prototype.setDialog=function(i){this.$dialog=t(i);var o=this.dialogEvents;for(var n in o){var s=o[n];if(s)for(var a in s)this.$dialog.on(n,s[a])}},l.prototype.resetDialog=function(){this.$dialog.find(\"form\")[0].reset()},l.prototype.openDialog=function(){if(this.$dialog)p.initData(),this.$dialog.modal(\"open\");else if(this.options.urls.dialog){var t=this;n.loadHtml(this.options.urls.dialog,function(i){t.setDialog(i),i.data(\"flower\",t),p.init(i),t.openDialog()})}},l.prototype.closeDialog=function(){this.$dialog&&(this.$dialog.modal(\"close\"),this.resetDialog(),this.session=\"\")},l.prototype.on=function(t,i){var o=t.substring(0,t.indexOf(\".\")),n=t.substring(t.indexOf(\".\")+1);switch(o){case\"dlg\":if(this.$dialog)this.$dialog.on(n,i);else{var s=this.dialogEvents;s[n]||(s[n]=[]),s[n].push(i)}break;case\"flw\":this.options[n]=i}return this},l.prototype.off=function(t,i){var o=t.substring(0,t.indexOf(\".\")),n=t.substring(t.indexOf(\".\")+1);switch(o){case\"dlg\":this.$dialog&&this.$dialog.off(n,i);var s=this.dialogEvents;if(s[n])if(i){var a=s[n].indexOf(i);-1!=a&&(s[n][a]=void 0)}else s[n]=[];break;case\"flw\":this.options[n]=void 0}return this},l.prototype.success=function(t){this.options.success=t},l.prototype.fail=function(t){this.options.fail=t},l.prototype.present=function(i){if(this.validate(i)){var o=this;o.session=(new Date).getTime(),n.sendKkpgvC(\"hit\",\"post\",o.session),t.getJSON(this.options.urls.present,i,function(s){if(\"object\"!=typeof s)throw new Error(\"illegal return value\");o.info.present=i.num;var a=o.info.hold-s.data.hits;o.info.hold=s.data.hits,o.info.out=a,p.setRemainNum(+o.info.hold),200==s.status?(n.sendKkpgvC(\"hit\",\"done\",o.session),e.call(o,s),t.isFunction(o.options.success)&&o.options.success(s,o)):(n.sendKkpgvC(\"hit\",\"error\"+s.status,o.session),r.call(o,s),t.isFunction(o.options.fail)&&o.options.fail(s,o))})}},l.prototype.openPayTipDialog=function(){if(this.closeDialog(),!this.payTip){var t=this;this.payTip=new a({desc:\"您的人气值不足，开通会员可获得更多人气值哦~\",buttons:{sure:\"开通看看会员\",cancel:\"关 闭\"},success:function(){n.sendKkpgvC(\"hit\",\"pay\",t.session);var i=new s({urls:{pay_order:\"http://backend.star.kankan.com/hit_order?jsoncallback=?&\"},payDesc:\"=1年看看会员 + 给艺人加人气 = 180元\",payInfo:{type:\"hit\",payAmount:\"12\",payType:\"E\"},payEndBtnText:\"确定\",success:function(){n.sendKkpgvC(\"hit\",\"payDone\",t.session),t.openDialog()}});i.openDialog()}})}this.payTip.openDialog()},l.prototype.getFormData=function(){var t=this.$dialog.find(\"form\"),i=t.find(\"input[type=text]\").val()||t.find(\"input[type=radio]:checked\").val();return{num:i,starid:this.target.id}},l.prototype.validate=function(t){return t.starid?!o.isInteger(t.num)||t.num<=0?(alert(\"请输入合法的人气数\"),!1):!0:!1};var p={$dialog:null,init:function(t){var i=t.find(\".cancel-btn ,.btn_close\"),o=t.find(\".sure-btn\"),n=t.data(\"flower\");i.click(function(){n.closeDialog()}),o.click(function(){var t=n.getFormData();n.present(t)}),t.find(\"input:text.form_flower\").on(\"focus\",function(){t.find(\"input:radio\").attr(\"checked\",!1)}),this.$dialog=t},initData:function(){if(this.$dialog){var i=this,o=this.$dialog.data(\"flower\");this.$dialog.find(\".picture img\").attr(\"src\",o.target.portrait),this.$dialog.find(\"h2 span\").text(o.target.name),this.$dialog.find(\"input:radio[value=360]\").attr(\"checked\",!0),t.getJSON(o.options.urls.info,function(t){200==t.status&&(o.info=t.data,i.setRemainNum(o.info.hold))})}},setRemainNum:function(t){this.$dialog&&this.$dialog.find(\".remain-flower-nums\").text(t)}};return l});\n//# sourceMappingURL=../../maps/js/common/flower.js.map\n//# sourceMappingURL=../../maps/js/common/flower.js.map"],"file":"js/common/flower.js","sourceRoot":"/source/"}