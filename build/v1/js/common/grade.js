define(["jquery","clib/modal","common/validate","common/utils"],function(t,i,e,a){function o(t){alert("评分成功"),this.closeDialog()}function n(t){alert(t.data.msg)}var s=function(i){this.dialogEvents={},this.options=t.extend(!0,{},s.defaults,i),this.options.dialog&&(this.setDialog(this.options.dialog),r.init(this.$dialog)),"object"==typeof this.options.target&&(this.target=this.options.target)};s.defaults={urls:{grade:"http://backend.star.kankan.com/rating?a=star&jsoncallback=?",dialog:"/grade_dialog.html"}},s.prototype.setDialog=function(i){this.$dialog=t(i);var e=this.dialogEvents;for(var a in e){var o=e[a];if(o)for(var n in o)this.$dialog.on(a,o[n])}},s.prototype.resetDialog=function(){this.$dialog.find("form")[0].reset(),this.$dialog.find("input[type=radio]").removeAttr("checked"),this.$dialog.find(".star_bg a").removeClass("active")},s.prototype.openDialog=function(){if(this.$dialog)r.initData(this.$dialog),this.$dialog.modal("open");else if(this.options.urls.dialog){var t=this;a.loadHtml(this.options.urls.dialog,function(i){t.setDialog(i),i.data("grade",t),r.init(i),t.openDialog()})}},s.prototype.closeDialog=function(){this.$dialog&&(this.$dialog.modal("close"),this.resetDialog(),session="")},s.prototype.validate=function(t){return"object"!=typeof t?!1:t.targetid?!e.isInteger(t.appearance)||t.appearance>5||t.appearance<1?(alert("请选择颜值评分ֵ"),!1):!e.isInteger(t.potential)||t.potential>5||t.potential<1?(alert("请选择潜能评分ֵ"),!1):!0:!1},s.prototype.on=function(t,i){var e=t.substring(0,t.indexOf(".")),a=t.substring(t.indexOf(".")+1);switch(e){case"dlg":if(this.$dialog)this.$dialog.on(a,i);else{var o=this.dialogEvents;o[a]||(o[a]=[]),o[a].push(i)}break;case"flw":this.options[a]=i}return this},s.prototype.off=function(t,i){var e=t.substring(0,t.indexOf(".")),a=t.substring(t.indexOf(".")+1);switch(e){case"dlg":this.$dialog&&this.$dialog.off(a,i);var o=this.dialogEvents;if(o[a])if(i){var n=o[a].indexOf(i);-1!=n&&(o[a][n]=void 0)}else o[a]=[];break;case"grd":this.options[a]=void 0}return this},s.prototype.success=function(t){this.options.success=t},s.prototype.fail=function(t){this.options.fail=t},s.prototype.grade=function(i){if(this.validate(i)){i.appearance=s.calcGrade(i.appearance),i.potential=s.calcGrade(i.potential);var e=this;e.session=(new Date).getTime(),a.sendKkpgvC("grade","post",e.session),t.getJSON(this.options.urls.grade,i,function(i){if("object"!=typeof i)throw new Error("illegal return value");200==i.status?(a.sendKkpgvC("grade","done",e.session),o.call(e,i),t.isFunction(e.options.success)&&e.options.success(i,e)):(a.sendKkpgvC("grade","error"+i.status,e.session),n.call(e,i),t.isFunction(e.options.fail)&&e.options.fail(i,e))})}},s.calcGrade=function(t){var i=2*t;return 1>i?1:i>10?10:i},s.prototype.getAppearanceValue=function(){return s.calcGrade(this.$dialog.find("#starBg1 input[type=radio]:checked").val())},s.prototype.getPotentialValue=function(){return s.calcGrade(this.$dialog.find("#starBg2 input[type=radio]:checked").val())},s.prototype.getFormData=function(){var t=this.$dialog.find("form"),i=a.serializeObject(t);return i.targetid=this.target.id,i};var r={$dialog:null,init:function(i){var e=i.find(".cancel-btn ,.close-btn"),a=i.find(".sure-btn"),o=i.data("grade");e.click(function(){o.closeDialog()});a.click(function(){var t=o.getFormData();o.grade(t)});var n=i.find(".star_bg");n.mouseenter(function(){var i=t(this);i.find("input[type=radio]:checked").next().removeClass("active")}).mouseleave(function(){var i=t(this);i.find("input[type=radio]:checked").next().addClass("active")}).delegate("a","click",function(){var i=t(this);i.siblings("input[type=radio]").removeAttr("checked"),i.prev().attr("checked",!0).click()}),this.$dialog=i},initData:function(){var t=this.$dialog,i=t.data("grade");t.find(".picture img").attr("src",i.target.portrait),t.find("h2 span").text(i.target.name)}};return s});
//# sourceMappingURL=../../maps/js/common/grade.js.map
//# sourceMappingURL=../../maps/js/common/grade.js.map
//# sourceMappingURL=../../js/maps/js/common/grade.js.map