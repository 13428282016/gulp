define(["jquery","clib/modal","common/validate","common/utils","common/pay","common/tip"],function(t,i,o,n,s,e){function a(t){200==t.status?(this.closeDialog(),r.options.desc="感谢您投资"+this.target.name+"，我们将在七个工作日内与您联系，办理后续事宜",r.openDialog()):alert(t.data.msg)}function l(t){alert(t.data.msg)}var r=new e({buttons:{sure:"关 闭"}}),c=new e({desc:"成为看看会员即可投资您喜欢的艺人，并获得收益。",buttons:{sure:"开通看看会员",cancel:"关 闭"}}),d=function(i){this.dialogEvents={},this.options=t.extend(!0,{},d.defaults,i),this.options.dialog&&(this.setDialog(this.options.dialog),p.init(this.$dialog)),"object"==typeof this.options.target&&(this.target=this.options.target)};d.defaults={urls:{info:"http://api.star.kankan.com/investor_info?a=info&jsoncallback=?",invest:"http://backend.star.kankan.com/invest?jsoncallback=?",dialog:window.location.protocol+"//"+window.location.host+"/invest_dialog.html"},success:function(t){},fail:function(t){}},d.prototype.setDialog=function(i){this.$dialog=t(i);for(var o in this.dialogEvents)this.$dialog.on(o,this.dialogEvents[o])},d.prototype.on=function(t,i){var o=t.substring(0,t.indexOf(".")),n=t.substring(t.indexOf(".")+1);switch(o){case"dlg":if(this.$dialog)this.$dialog.on(n,i);else{var s=this.dialogEvents;s[n]||(s[n]=[]),s[n].push(i)}break;case"ivs":this.options[n]=i}return this},d.prototype.off=function(t,i){var o=t.substring(0,t.indexOf(".")),n=t.substring(t.indexOf(".")+1);switch(o){case"dlg":this.$dialog&&this.$dialog.off(n,i);var s=this.dialogEvents;if(s[n])if(i){var e=s[n].indexOf(i);-1!=e&&(s[n][e]=void 0)}else s[n]=[];break;case"ivs":this.options[n]=void 0}return this},d.prototype.resetDialog=function(){this.$dialog.find("form")[0].reset()},d.prototype.openDialog=function(){if(this.$dialog)p.initData(),this.$dialog.modal("open");else if(this.options.urls.dialog){var t=this;n.loadHtml(this.options.urls.dialog,function(i){t.setDialog(i),i.data("invest",t),p.init(i),t.openDialog()})}},d.prototype.closeDialog=function(){this.$dialog&&(this.$dialog.modal("close"),this.resetDialog(),this.session="")},d.prototype.success=function(t){this.options.success=t},d.prototype.fail=function(t){this.options.fail=t},d.prototype.investor=function(t){var i=this;i.session=(new Date).getTime(),t?i.openDialog():(c.success(function(){n.sendKkpgvC("invest","pay",i.session);var t=new s({payDesc:"=1年看看会员 + 艺人投资权 = 180元",payInfo:{type:"investor",payAmount:"12",payType:"E"},payEndBtnText:"下一步",success:function(){n.sendKkpgvC("invest","payDone",i.session),i.openDialog()},fail:function(){}});t.openDialog()}),c.openDialog())},d.prototype.invest=function(i){if(this.validate(i)){var o=this;n.sendKkpgvC("invest","post",o.session),t.getJSON(this.options.urls.invest,i,function(i){if("object"!=typeof i)throw new Error("illegal return value");200==i.status?(n.sendKkpgvC("invest","done",o.session),a.call(o,i),t.isFunction(o.options.success)&&o.options.success(i,o)):(n.sendKkpgvC("invest","error"+i.status,o.session),l.call(o,i),t.isFunction(o.options.fail)&&o.options.fail(i,o))})}},d.prototype.validate=function(t){return"object"!=typeof t?!1:t.targetid?o.required(t.name)?o.isIdCard(t.identity)?!o.isNumeric(t.num)||t.num<=0?(alert("请输入合法的金额"),!1):o.isCellphone(t.contact)?!0:(alert("请输入正确的手机号码"),!1):(alert("请输入正确的身份证号码"),!1):(alert("请输入名字"),!1):!1},d.prototype.getFormData=function(){var t=this.$dialog.find("form"),i=n.serializeObject(t);return i.targetid=this.target.id,i};var p={$dialog:null,init:function(t){var i=t.find(".cancel-btn ,.close-btn"),o=t.find(".sure-btn"),n=t.data("invest");i.click(function(){n.closeDialog()}),o.click(function(){var t=n.getFormData();n.invest(t)}),this.$dialog=t},initData:function(){if(this.$dialog){var i=this,o=this.$dialog.data("invest");this.$dialog.find(".picture img").attr("src",o.target.portrait),this.$dialog.find("h2 span").text(o.target.name),t.getJSON(o.options.urls.info,function(t){if(200==t.status){var o=t.data.investor_info||{},n=i.$dialog.find("form[name=iv_form]");n.find("input[name=name]").val(o.name),n.find("input[name=identity]").val(o.identity),n.find("input[name=contact]").val(o.contact),n.find("input[name=money]").val(o.money)}})}}};return d});
//# sourceMappingURL=../../maps/js/common/invest.js.map
//# sourceMappingURL=../../maps/js/common/invest.js.map
//# sourceMappingURL=../../js/maps/js/common/invest.js.map