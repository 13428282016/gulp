require(["jquery","common/utils","birthday","jquery.fileupload","common/header","common/type_to_text","common/validate","common/talent_player","clib/area"],function(t,n,e,i,a,o,s,r,l){function d(){M=t("#user_info"),z=window.star,z.portraits||(z.portraits=[]),L=t(".portraits form"),G(E()),N(E()),D=t(".artist_data > form"),U=t(".talents > form"),t(".birthday").birthday({year:"year",month:"month",day:"day"}),H=new l(["[name=province]","[name=city]"]),H.loadAllData(null,function(){V(z)}),t("#edit_star_info").click(function(){t(this);_()&&(nt=!0,V(z),B())}),t("#cancel_edit_user_info_btn").click(function(){t(this);nt=!1,$img=t(".photo img"),$img.attr("src",$img.data("old-src")||""),j()}),t(".photo").on("click",".file-upload-btn",function(){var n=t(".photo img"),e=t(this),i={source:e,img:n};J(i,function(t){n.attr("src",t.files[0])})}),t("#sure_edit_user_info_btn").click(function(){var e=t(this);n.disableBtn(e,"正在保存..."),n.disableBtn("#cancel_edit_user_info_btn").hide(),q(m,v)}),t("#edit_portrait_btn").click(function(){_()&&f()}),t("#sure_edit_portrait_btn").click(function(){var e=t(this);n.disableBtn(e,"正在保存..."),n.disableBtn("#cancel_edit_portrait_btn").hide(),A(X,O)}),t("#cancel_edit_portrait_btn").click(function(){p()}),L.on("click",".upload-btn",function(){var n=t(this),e=n.siblings("img"),i={source:n,img:e,re_text:"<span>重新上传</span><i>建议尺寸：660X750</i>"};J(i,function(t){e.attr("src",t.files[0]).show(),e.siblings("p").hide(),e.siblings(".delete-btn").show(),n.parent().removeClass("empty")})}).on("click",".delete-btn",function(){var n=t(this),e=n.siblings("img");e.removeAttr("src").hide(),n.siblings(".upload-btn").html("<span>点击上传</span><i>建议尺寸：660X750</i>"),n.siblings("p").show(),n.parent().addClass("empty"),n.hide()}),t("#submit_all_info").click(function(){var e=t(this);_()&&(n.disableBtn(e),c(function(t,n){alert("已提交，请等待审核！"),z.status=2,e.text("审核中...")},function(t,i){alert("提交失败！"),n.enableBtn(e)}))}),t("div.skill-show ul > li").on("click","a[videoid]",function(n){var e=t(this).attr("videoid"),i=t(this).next().text();e&&it.play(e,i)}),t("#edit_talent_btn").click(function(){var n=t(this);n.hide(),u()}),t("#cancel_edit_talent_btn").click(function(){var n=t(this);n.show(),h()}),U.find("#sure_edit_talent_btn,.upload-btn,.delete-btn").click(function(){alert("暂不支持自主上传，请将视频文件发送至kankanvipgg@kankan.com，并注明您的看看用户名。")})}function c(e,i){$(function(a){var o=x();T(o)&&n.ajaxBK4KK(a,tt,"data="+JSON.stringify(o)+"&a=update",function(n){nt=!1,200==n.status?t.isFunction(e)&&e(n,o):t.isFunction(i)&&i(n,o)})})}function u(){nt=!0,U.find(".button-bottom").show(),t("#edit_talent_btn").hide();var n=z.talents;U.find("li").each(function(e,i){var a=t(i),o=a.find(".upload-btn"),s=a.find(".delete-btn"),r=a.find(".title-text"),l=a.find(".title-input"),d=a.find(".video"),c=(a.find(".playico"),a.find(".people-icon"),a.find(".play-icon"),a.find(".talent-icon")),u=n[e],f=a.children("div"),h=a.children("p");c.hide(),r.hide(),h.hide(),f.show(),u?(o.html("<span>重新上传</span><i>建议尺寸：660X750</i>").show(),s.show(),l.val(u.title).show(),d.data("videoid",u.file)):(o.html("<span>点击上传</span><i>建议尺寸：660X750</i>").show(),s.hide(),l.val("").show(),d.data("videoid",""))})}function f(){nt=!0,L.find(".button-bottom").show(),t("#edit_portrait_btn").hide(),L.find("img").each(function(n,e){var i=t(e),a=i.siblings(".upload-btn"),o=i.siblings(".delete-btn"),s=i.siblings("p");i.data("old-src",i.attr("src")),z.portraits[n]?(a.html("<span>重新上传</span><i>建议尺寸：660X750</i>").show(),o.show(),i.show(),i.parent().removeClass("empty"),s.hide()):(a.html("<span>点击上传</span><i>建议尺寸：660X750</i>").show(),s.show(),i.hide(),i.parent().addClass("empty"))})}function h(){U.find(".button-bottom").hide(),t("#edit_talent_btn").show();var n=z.talents;U.find("li").each(function(e,i){var a=t(i),o=a.find(".upload-btn"),s=a.find(".delete-btn"),r=a.find(".title-text"),l=a.find(".title-input"),d=a.find(".video"),c=(a.find(".playico"),a.find(".people-icon"),a.find(".play-icon"),n[e]),u=a.find(".talent-icon"),f=a.children("div"),h=a.children("p");o.hide(),s.hide(),l.hide(),c?(d.data("videoid",c.file),u.show(),r.show(),f.show(),h.hide()):(r.hide(),d.data("videoid",""),u.hide(),h.show(),f.hide())}),nt=!1}function p(){L.find(".button-bottom").hide(),L.find("img").each(function(n,e){var i=t(e),a=i.siblings(".upload-btn"),o=i.siblings(".delete-btn"),s=i.siblings("p");a.hide(),o.hide(),z.portraits[n]?(i.attr("src",i.data("old-src")),i.show(),s.hide(),i.parent().removeClass("empty")):(s.show(),i.hide(),i.removeAttr("src"),i.parent().addClass("empty"))}),t("#edit_portrait_btn").show(),nt=!1}function _(){return nt?(alert("一次只能编辑一模块！"),!1):2==z.status?(alert("信息审核中,请耐心等待审核结果!"),!1):!0}function m(e,i){nt=!1;var a=z.name,o=z.status;z=i,z.name=a,z.status=o,z.cover=t(".photo img").attr("src"),b(z),j(),n.enableBtn("#sure_edit_user_info_btn"),n.enableBtn("#cancel_edit_user_info_btn").show()}function b(e){e.sex_text=n.getSelectText("[name=sex]",e.sex),e.nationality_text=n.getSelectText("[name=nationality]",e.nationality),e.style_text=n.getSelectText("[name=style]",e.style),M.find(".sex span").text(e.sex_text),M.find(".nationality span").text(e.nationality_text),M.find(".college span").text(e.college),M.find(".profession span").text(e.profession),M.find(".stature span").text(e.stature),M.find(".weight span").text(e.weight),M.find(".style span").text(e.style_text),M.find(".speciality span").text(e.speciality),M.find(".birthday span").text(e.birthday),M.find(".native_place span").text(e.native_place),t("#integrity").text(n.calcIntegrity(e)+"%")}function v(t){alert("保存失败！"),n.enableBtn("#sure_edit_user_info_btn"),n.enableBtn("#cancel_edit_user_info_btn").show()}function y(){var n={};return n.is_show_portrait=t("[name=show_portrait]:checked").length?!0:!1,n.portraits=g(),n}function g(){return L.find("img").map(function(t,n){return n.src?{file:n.src}:void 0}).get()}function w(){return z.talents||[]}function k(){var n={};return n.is_show_talent=t("[name=show_talent]:checked").length?!0:!1,n.talents=w(),n}function x(){var n=F()||{};return t.extend(!0,n,k()),t.extend(!0,n,y()),n.section_show_status=[0,0],n.is_show_talent&&(n.section_show_status[1]=1),n.is_show_portrait&&(n.section_show_status[0]=1),n.section_show_status=n.section_show_status.join(""),n}function B(){t("#edit_star_info").hide(),t(".detail-data .detail").hide(),t(".photo .update").show(),t("#edit_form").show(),$img=t(".photo img"),$img.data("old-src",$img.attr("src"))}function j(){t(".detail-data .detail").show(),t(".photo .update").hide(),t("#edit_form").hide(),t("#edit_star_info").show()}function F(){var e=n.serializeObject(D);e.cover=t(".photo img").attr("src"),K(e);var i=H.getSelectedValueObject();return t.extend(e,i),e.native_place=H.getSelectedValue("-"),e.birthday=(e.year||"")+"-"+(e.month||"")+"-"+(e.day||""),e}function K(t){t.cover&&(t.cover_folder=t.cover.substring(0,t.cover.lastIndexOf("/")+1).replace(/http(.*).com\//,""),t.cover_name=t.cover.substring(t.cover.lastIndexOf("/")+1))}function I(t){return t.sex?parseInt(t.year)&&parseInt(t.month)&&parseInt(t.day)?s.required(t.cover)?t.nationality?s.required(t.college)?s.required(t.profession)?s.required(t.speciality)?s.isNumeric(t.stature)&&3==t.stature.length?!s.isNumeric(t.weight)||2!=t.weight.length&&3!=t.weight.length?(alert("体重必须为2-3位数字"),!1):t.city&&t.province?!0:(alert("您还没有填写籍贯"),!1):(alert("您还没有填写3位数字的身高"),!1):(alert("您还没有填写特长"),!1):(alert("您还没有填写职业"),!1):(alert("您还没有填写学校"),!1):(alert("您还没有填写民族"),!1):(alert("您还没有上传头像照片"),!1):(alert("您还没有填写生日"),!1):(alert("您还没有填写性别"),!1)}function C(t){return!0}function T(t){return I(t)&&C(t.portraits)&&S(t.talents)}function S(t){return!0}function q(e,i){$(function(a){var o=x();n.ajaxBK4KK(a,Y,"data="+JSON.stringify(o),function(n){nt=!1,200==n.status?t.isFunction(e)&&e(n,o):t.isFunction(i)&&i(n,o)})})}function O(t,e){n.enableBtn("#sure_edit_user_info_btn"),n.enableBtn("#cancel_edit_user_info_btn").show()}function X(e,i){t.extend(z,i),n.enableBtn("#sure_edit_portrait_btn"),n.enableBtn("#cancel_edit_portrait_btn").show(),L.find(".button-bottom").hide(),L.find("img").each(function(n,e){var i=t(e),a=i.siblings(".upload-btn"),o=i.siblings(".delete-btn"),s=i.siblings("p");a.hide(),o.hide(),z.portraits[n]?(i.attr("src",z.portraits[n].file),i.show(),s.hide(),i.parent().removeClass("empty")):(s.show(),i.hide(),i.removeAttr("src"),i.parent().addClass("empty"))}),t("#edit_portrait_btn").show(),nt=!1}function $(e){var i=D.data("iframe");return i?void(t.isFunction(e)&&e(i)):void n.createBK4KKIfr(W,R,function(){D.data("iframe",W),t.isFunction(e)&&e(W)})}function A(e,i){$(function(a){var o=x();n.ajaxBK4KK(a,Y,"data="+JSON.stringify(o),function(n){nt=!1,200==n.status?t.isFunction(e)&&e(n,o):t.isFunction(i)&&i(n,o)})})}function N(e){t.ajax({url:et,dataType:"jsonp",data:{userid:e},method:"GET",jsonp:"jsoncallback",success:function(e){if(200==e.status){var i=e.data;t("#total_hit_rank").text(i.hit.rank),t("#total_hit").text(n.moneyFormat(i.hit.score)),t("#week_hit_rank").text(i.hit_week.rank),t("#week_hit").text(n.moneyFormat(i.hit_week.score)),t("#invest_total_money").text(n.moneyFormat(i.invest.score)),t("#invest_name").text(i.invest.leader)}}})}function J(e,i,a){var o=t("<input type='file' name='file'>");o.fileupload({dataType:"json",url:P,forceIframeTransport:!0,redirect:Q,autoUpload:!0,done:function(n,e){var o=e.result;200==o.status?t.isFunction(i)&&i(o):t.isFunction(a)&&a(o)},add:function(t,i){n.disableBtn(e.source,"<span>正在上传...</span><i>建议尺寸：660X750</i>"),i.submit()},always:function(){n.enableBtn(e.source),e.re_text&&t(e.source).html(e.re_text),delete o[0],o=null}}),o.click()}function E(){return t("input[type=hidden].id").val()}function G(n){t.ajax({url:Z,dataType:"jsonp",data:{userid:n},method:"GET",jsonp:"jsoncallback",success:function(n){if(200==n.status){var e="",i=n.data;for(var a in i){if(a>=10)break;e+=o.userActionMsg(i[a])}t("div.dynamic ul").html(e)}}})}function V(t){D.find("[name=sex]").val(t.sex),D.find("[name=nationality]").val(t.nationality),D.find("[name=college]").val(t.college),D.find("[name=profession]").val(t.profession),D.find("[name=stature]").val(t.stature),D.find("[name=weight]").val(t.weight),D.find("[name=style]").val(t.style),D.find("[name=speciality]").val(t.speciality);var n,e=t.birthday;n=e?e.split("-"):[0,0,0];var i=t.native_place,a=i?i.split("-"):["",""];a.length=2,H.select(a),D.find("[name=year]").val(t.year||n[0]),D.find("[name=month]").val(parseInt(t.month||n[1])),D.find("[name=day]").val(parseInt(t.day||n[2]))}var z,D,L,M,U,H,P="http://backend.star.kankan.com/image_upload?type=avatar",Q="http://star.kankan.com/upload_result.html?%s",R="http://backend.star.kankan.com/post",W="user_info_iframe",Y="http://backend.star.kankan.com/star_draft",Z="http://api.star.kankan.com/user_info?a=actions",tt="http://backend.star.kankan.com/star_info",nt=!1,et="http://api.star.kankan.com/star_info?a=hit_invest_info",it=new r;a.addLogoutCallback(function(){window.location="http://star.kankan.com"}),t(function(){d()})});
//# sourceMappingURL=../../maps/js/star/homepage_edit.js.map
//# sourceMappingURL=../../maps/js/star/homepage_edit.js.map
//# sourceMappingURL=../../js/maps/js/star/homepage_edit.js.map